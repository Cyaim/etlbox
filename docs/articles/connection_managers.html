<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
  	<!-- Global site tag (gtag.js) - Google Analytics -->
  	<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-42296700-2"></script>
  	<script>
  	  window.dataLayer = window.dataLayer || [];
  	  function gtag(){dataLayer.push(arguments);}
  	  gtag('js', new Date());
  
  	  gtag('config', 'UA-42296700-2');
  	</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Connection managers </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Connection managers ">
    <meta name="generator" content="docfx 2.44.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
				<div class="buttons-unit">
					<a href="https://github.com/roadrunnerlenny/etlbox" class="button"><i class="glyphicon glyphicon-eye-open"></i> View on Github</a>
					<a href="https://www.nuget.org/packages/ETLBox" class="button"><i class="glyphicon glyphicon-download"></i> Download on Nuget</a>
					<a href="https://www.youtube.com/watch?v=CsWZuRpl6PA" class="button"><i class="glyphicon glyphicon-play-circle"></i> See the video</a>
				</div>
<h1 id="connection-managers">Connection managers</h1>

<h2 id="adonet-connection-pooling">ADO.NET Connection pooling</h2>
<p>First of all, please let me clarify something about the Open() method of the connection manager:
Whenever this method is called (doesn't matter if this happens on a completely new object or the object
already exists), it will use instantiate a new connection on the underlying ADO.NET provider.
It will also call the open method on this provider. But this won't always create a new database connection.
The method naming Open could be misleading here - it actually should be something like 'OpenOrReuseConnectionFromPool. The reason for that is that ADO.NET (which the whole connection handling is based upon) has it's own connection pooling. Whenever you try to open a connection (which includes opening up the right port, doing a handshake, authentification etc.), the ADO.NET connection pooling will check if it makes sense to open up a new connection or if it could reuse an existing - already opened - connection from the pool. Whenever you call the Close()` method (which is totally recommended when using ADO.NET),this won't automatically close the connection. It will just return the connection to the pool - it will stay open until ADO.NET decides that it not needed anymore.</p>
<p>Please see here for more details of connection pooling: <a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling">https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling</a></p>
<p>Thus having said, I don't think that calling the open / close (and also recreating the object every time) is actually a performance hit. It will just use the connection pooling provided - as recommended by ADO.NET, which probably will perform already very well. So if you would create a test environment where you open up a lot of connections to the database, you would see that the connection pool would have only one connection which stays open. So calling Open and Close multiple times in a row would in most cases never open up more than one connection. I also have a Test regarding the this pooling behavior in my test project:</p>
<p>etlbox/TestsETLBox/src/DataFlowTests/ConnectionManager/SqlConnectionManagerTests.cs</p>
<p>Lines 64 to 76 in 9135059
[Fact]
public void TestOpeningConnectionTwice()
{
SqlConnectionManager con = new SqlConnectionManager(new ConnectionString(ConnectionStringParameter));
AssertOpenConnectionCount(0, ConnectionStringParameter);
con.Open();
con.Open();
AssertOpenConnectionCount(1, ConnectionStringParameter);
con.Close();
AssertOpenConnectionCount(1, ConnectionStringParameter);
SqlConnection.ClearAllPools();
AssertOpenConnectionCount(0, ConnectionStringParameter);
}</p>
<p>In this test class you will also find other scenarios testing the ADO.NET pooling.</p>
<p>TL;DR; - the current implementation follows the recommendation of Microsoft and makes use of the connection pooling provided by ADO.NET. This means that this actually can increase your performance, and in most scenarios you never have more connections open that you actually need for your application.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/roadrunnerlenny/etlbox/blob/master/ETLBoxDocu/articles/connection_managers.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>(C) 2018 Andreas Lennartz<br>
      		<a href="https://etlbox.net/articles/imprint.html">Contact & legal information</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
