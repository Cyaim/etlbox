<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
  	<!-- Global site tag (gtag.js) - Google Analytics -->
  	<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-42296700-2"></script>
  	<script>
  	  window.dataLayer = window.dataLayer || [];
  	  function gtag(){dataLayer.push(arguments);}
  	  gtag('js', new Date());
  
  	  gtag('config', 'UA-42296700-2');
  	</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Logging | ETLBox - It's all in the box </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Logging | ETLBox - It's all in the box ">
    <meta name="generator" content="docfx 2.47.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="logging">Logging</h1>

<p>By default, ETLBox uses NLog. NLog already comes with different log targets that be configured either via your app.config or programmatically.
See the NLog-documentation for a full reference: <a href="https://nlog-project.org/">https://nlog-project.org/</a>
ETLBox already comes with NLog as dependency - so the necessary packages will be retrieved from nuget automatically through your package manager.</p>
<h2 id="simple-configuration-file">Simple Configuration File</h2>
<p>In order to use logging, you have to create a <code>nlog.config</code> file (with exact this name) and put it into the root folder of your project.
Make sure that it is copied into your output directory.</p>
<p>A simple and very basic nlog.config could look like this</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;nlog xmlns=&quot;http://www.nlog-project.org/schemas/NLog.xsd&quot;
      xsi:schemaLocation=&quot;NLog NLog.xsd&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;rules&gt;
    &lt;logger name=&quot;*&quot; minlevel=&quot;Info&quot; writeTo=&quot;console&quot; /&gt;
  &lt;/rules&gt;
  &lt;targets&gt;
    &lt;target name=&quot;console&quot; xsi:type=&quot;Console&quot; /&gt;     
  &lt;/targets&gt;
&lt;/nlog&gt;
</code></pre>
<p>After adding a file with this configuration, you will already get some logging output to your console output.</p>
<h2 id="logging-into-files">Logging into files</h2>
<p>Nlog can be easily configured to have your logging output stored in files. Here is an example for a simple configuration that will
create a Log - folder within your application directory and have a file for every error level provided by Nlog.
(NLog does differentiate each log entry by a log level, which are: Trace, Debug, Info, Warn, Error and Fatal.)</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;nlog xmlns=&quot;http://www.nlog-project.org/schemas/NLog.xsd&quot;
      xsi:schemaLocation=&quot;NLog NLog.xsd&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;targets&gt;
    &lt;target name=&quot;file&quot; xsi:type=&quot;AsyncWrapper&quot;
            queueLimit=&quot;5000&quot;
            overflowAction=&quot;Discard&quot;&gt;
      &lt;target xsi:type=&quot;File&quot; fileName=&quot;${basedir}/logs/${level}.txt&quot;
              deleteOldFileOnStartup=&quot;true&quot;
              layout=&quot;${longdate}|${pad:padding=10:fixedLength=true:inner=${etllog:LogType=STAGE}}|${pad:padding=20:fixedLength=true:inner=${etllog:LogType=Type}}|${pad:padding=5:fixedLength=true:inner=${etllog:LogType=Action}}|${etllog}&quot; /&gt;
    &lt;/target&gt;
  &lt;/targets&gt;
  &lt;rules&gt;
    &lt;logger name=&quot;*&quot; minlevel=&quot;Debug&quot; writeTo=&quot;file&quot; /&gt;
  &lt;/rules&gt;
&lt;/nlog&gt;
</code></pre>
<p>As you can see, the log output into the file is alreday formatted using particular ETLBox extensions provided by NLog.</p>
<h3 id="setting-the-logging-stage">Setting the logging stage</h3>
<p>One thing you perhaps want to know in your logging output is the current stage of your data processing. Think you this as a category
for your log output - if things happen during the setup of your database, the Stage could be &quot;SETUP&quot; - if you are currently staging your
data from your sources into your database the stage could be &quot;STAGING&quot;.</p>
<p>To set up or modify the current stage, just change the static property <code>Stage</code> in the <code>ControlFlow</code> class:</p>
<pre><code class="lang-C#">ControlFlow.STAGE = &quot;SETUP&quot;
//some logging
ControlFlow.STAGE = &quot;STAGING&quot;
</code></pre>
<h3 id="disable-logging">Disable logging</h3>
<p>Perhaps you want some particular tasks or components not to produce any log output, but you don't want to remove the logging completely.
For this case you can use the <code>DisableLogging</code> property on every task or component in ETLBox. E.g., if you create a new DBSource, just set
the property to true:</p>
<pre><code class="lang-C#">DBSource source = new DBSource(&quot;TableName&quot;) { DisableLogging = true};
</code></pre>
<p>If you want to disable logging in general for all tasks, you can set the static property <code>DisableAllLogging</code> in the ControlFlow class:</p>
<pre><code class="lang-C#">ControlFlow.DisableAllLogging = true;
</code></pre>
<p>Whenever set to true, no logging output will be produced. When set back to false, logging will be activated again.</p>
<h2 id="logging-to-database">Logging to database</h2>
<p>Of course logging to console output or to a file is perhaps not sufficient. If you want to have logging tables in your database,
ETLBox comes with some additions to the default logging mechanism provided by NLog.</p>
<p>Additionally to the traditional nlog setup where log information can be send to any target by changing the configuration,
ETLBox comes with a set of Tasks and a recommended nlog configuration.
This will allow you to have a more advanced logging into your database.</p>
<p>E.g, you can create log tables and stored procedures useful for logging in SQL with the <code>CreateLogTablesTask</code>.
It will basically create two log tables - a table for the &quot;normal&quot; log and a table  to store information about your ETL process.
Whenever you use a Control Flow or Data Flow task, log information then is written into the log table.
Additionally, you can use tasks like <code>StartLoadProcessTask</code> or <code>EndLoadProcessTask</code> which will write information about the current
ETL process into the ETL process table.</p>
<h3 id="extend-the-nlogconfig">Extend the nlog.config</h3>
<p>As a first step to have nlog log into your database, you must extend your nlog configuration and add the database as target.
It should then look like this:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;nlog xmlns=&quot;http://www.nlog-project.org/schemas/NLog.xsd&quot;
      xsi:schemaLocation=&quot;NLog NLog.xsd&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;targets&gt;
    &lt;target name=&quot;console&quot; xsi:type=&quot;Console&quot; /&gt;  
    &lt;target xsi:type=&quot;Database&quot; name=&quot;database&quot;
       useTransactions=&quot;false&quot; keepConnection=&quot;true&quot;&gt;
      &lt;commandText&gt;
        insert into etl.Log (LogDate, Level, Stage, Message, TaskType, TaskAction, TaskHash, Source, LoadProcessKey)
        select @LogDate
        , @Level
        , cast(@Stage as nvarchar(20))
        , cast(@Message as nvarchar(4000))
        , cast(@Type as nvarchar(40))
        , @Action
        , @Hash
        , cast(@Logger as nvarchar(20))
        , case when @LoadProcessKey=0 then null else @LoadProcessKey end
      &lt;/commandText&gt;
      &lt;parameter name=&quot;@LogDate&quot; layout=&quot;${date:format=yyyy-MM-ddTHH\:mm\:ss.fff}&quot; /&gt;
      &lt;parameter name=&quot;@Level&quot; layout=&quot;${level}&quot; /&gt;
      &lt;parameter name=&quot;@Stage&quot; layout=&quot;${etllog:LogType=Stage}&quot; /&gt;
      &lt;parameter name=&quot;@Message&quot; layout=&quot;${etllog}&quot; /&gt;
      &lt;parameter name=&quot;@Type&quot; layout=&quot;${etllog:LogType=Type}&quot; /&gt;
      &lt;parameter name=&quot;@Action&quot; layout=&quot;${etllog:LogType=Action}&quot; /&gt;
      &lt;parameter name=&quot;@Hash&quot; layout=&quot;${etllog:LogType=Hash}&quot; /&gt;
      &lt;parameter name=&quot;@LoadProcessKey&quot; layout=&quot;${etllog:LogType=LoadProcessKey}&quot; /&gt;
      &lt;parameter name=&quot;@Logger&quot; layout=&quot;${logger}&quot; /&gt;
    &lt;/target&gt;
  &lt;/targets&gt;
  &lt;rules&gt;
    &lt;logger name=&quot;*&quot; minlevel=&quot;Debug&quot; writeTo=&quot;database&quot; /&gt;
    &lt;logger name=&quot;*&quot; minlevel=&quot;Info&quot; writeTo=&quot;console&quot; /&gt;
  &lt;/rules&gt;
&lt;/nlog&gt;
</code></pre>
<h3 id="copy-to-output-directory">Copy to output directory</h3>
<p>Make sure the config file is copied into the output directory where you build executables are dropped.
Your project configuration file .csproj should contain something like this:</p>
<pre><code class="lang-C#">&lt;Itemgroup&gt;
...
  &lt;None Update=&quot;nlog.config&quot;&gt;
    &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;
  &lt;/None&gt;
&lt;/Itemgroup&gt;
</code></pre>
<h3 id="create-database-tables">Create database tables</h3>
<p>Now you need some tables in the database to store your log information.
You can use the task <code>CreateLogTables</code>. This task will create two tables:
<code>etl.LoadProcess</code> and <code>etl.Log</code>.
It will also create some stored procedure to access this tables. This can be useful if you want
to log into these table in your sql code or stored procedures.</p>
<p><strong>Note</strong>: Don't forget the setup the connection for the control flow.</p>
<pre><code class="lang-C#">CreateLogTablesTask.CreateLog();
</code></pre>
<h3 id="loadprocess-table">LoadProcess table</h3>
<p>The table etl.LoadProcess contains information about the ETL processes that you started programmatically with the <code>StartLoadProcessTask</code>.
To end or abort a process, you can use the <code>EndLoadProcessTask</code> or <code>AbortLoadProcessTask</code>. To set the TransferCompletedDate in this table, use
the <code>TransferCompletedForLoadProcessTask</code></p>
<p>This is an example for logging into the load process table.</p>
<pre><code class="lang-C#">StartLoadProcessTask.Start(&quot;Process 1 started&quot;);
/*..*/
TransferCompletedForLoadProcessTask.Complete();
/*..*/
if (error)
   AbortLoadProcessTask.Abort(&quot;This is the abort message&quot;);
else 
  EndLoadProcessTask.End(&quot;Process 1 ended successfully&quot;);
</code></pre>
<h3 id="log-table">Log Table</h3>
<p>The etl.Log table will store all log message generated from any control flow or data flow task.
You can even use your own LogTask to create your own log message in there.
The following example will create 6 rows in your <code>etl.Log</code> table. Every time a Control Flow Tasks starts,
it will create a log entry with an action 'START'. When it's done with its execution, it will create
another log entry with action type 'END'</p>
<pre><code class="lang-C#">SqlTask.ExecuteNonQuery(&quot;some sql&quot;, &quot;Select 1 as test&quot;);
Sequence.Execute(&quot;some custom code&quot;, () =&gt; { });
LogTask.Warn(&quot;Some warning!&quot;);
</code></pre>
<p>The sql task will produce two log entries - one entry when it started and one entry when it ended its execution.</p>
<h3 id="further-log-tasks">Further log tasks</h3>
<p>There are some more logging tasks that can be used to manage your log tables.</p>
<h4 id="clean-up-or-remove-log-table">Clean up or remove log table</h4>
<p>You can clean up your log with the CleanUpLogTask.</p>
<pre><code class="lang-C#">CleanUpLogTask.Clean();
</code></pre>
<p>Or you can remove the log tables and all its procedure from the database.</p>
<pre><code class="lang-C#">RemoveLogTablesTask.Remove();
</code></pre>
<h4 id="get-log-and-loadprocess-table-in-json">Get log and loadprocess table in JSON</h4>
<p>If you want to get the content of the etl.LoadProcess table or etl.Log in JSON-Format, there are two tasks for that:</p>
<pre><code>GetLoadProcessAsJSONTask.GetJSON();
GetLogAsJSONTask.GetJSON();
</code></pre>
<h4 id="custom-log-messages">Custom log messages</h4>
<p>If you want to create an entry in the etl.Log table (just one entry, no START/END messages) you can do this using the LogTask.
Also you can define the nlog level.</p>
<pre><code class="lang-C#">LogTask.Trace(&quot;Some text!&quot;);
LogTask.Debug(&quot;Some text!&quot;);
LogTask.Info(&quot;Some text!&quot;);
LogTask.Warn(&quot;Some text!&quot;);
LogTask.Error(&quot;Some text!&quot;);
LogTask.Fatal(&quot;Some text!&quot;);
</code></pre>
<h2 id="debugging-logging-issues">Debugging logging issues</h2>
<p>NLog normally behaves very &quot;fault-tolerant&quot;. By default, if something is not setup properly or does not work
when NLog tries to log, it just &quot;stops&quot; working without throwing an exception or stopping the execution.
This behavior is very desirable in a production environment, but hard to debug.</p>
<p>If you need to debug Nlog, you can change the nlog root-element of the nlog.config  into:</p>
<pre><code class="lang-xml">&lt;nlog xmlns=&quot;http://www.nlog-project.org/schemas/NLog.xsd&quot;
      xsi:schemaLocation=&quot;NLog NLog.xsd&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      throwConfigExceptions=&quot;true&quot;
      autoReload=&quot;true&quot;
      internalLogFile=&quot;console-example-internal.log&quot;
      internalLogLevel=&quot;Info&quot;&gt;
</code></pre>
<p>With this configuration it will raise an exception and also log it into a file.</p>
<h2 id="etlbox-logviewer">ETLBox Logviewer</h2>
<p><strong>Warning</strong>: The ETLBox Logviewer is still in BETA. Any support to improve this tool is highly appreciated.</p>
<p>Once you have data in these log tables, you can use the <a href="https://github.com/roadrunnerlenny/etlboxlogviewer">ETLBox LogViewer</a> to
easily access and analyze your logs.</p>
<span>
    <img src="https://github.com/roadrunnerlenny/etlbox/raw/master/docs/images/logviewer_screen1.png" width="350" alt="Process Overview of ETLBox LogViewer">
    <img src="https://github.com/roadrunnerlenny/etlbox/raw/master/docs/images/logviewer_screen2.png" width="350" alt="Process Details of ETLBox LogViewer">
</span>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/roadrunnerlenny/etlbox/blob/dev/ETLBoxDocu/articles/controlflow/overview_logging.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Crafted with &lt;3 in Berlin<br>
<a href="https://etlbox.net/articles/imprint.html">Contact & legal information</a></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
